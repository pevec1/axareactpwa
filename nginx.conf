server {
    # 1. Основные настройки
    listen 80;
    server_name localhost; # Замените на ваш домен или localhost
    
    # Указываем корневую директорию, где лежат ваши статические файлы (папка 'build' React)
    # В Docker Nginx это обычно /usr/share/nginx/html
    root /usr/share/nginx/html; 
    index index.html;

    # 2. Ключевая настройка для SPA (Single Page Application)
    location / {
        # Если запрошенный URI ($uri) не является существующим файлом ($uri/) и не является существующей директорией, 
        # Nginx перенаправляет запрос на index.html.
        # Это позволяет React Router обрабатывать маршруты (/about, /dashboard).
        try_files $uri $uri/ /index.html;
    }

    # 3. Настройки кэширования для PWA/Статических ресурсов
    # Эта секция важна для PWA, так как она устанавливает заголовки кэширования для браузера.
    # Service Worker берет управление на себя, но Nginx должен сообщить браузеру, как долго кэшировать файлы.
    location ~* \.(?:css|js|jpe?g|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webp|webm|htc|json|webmanifest)$ {
        # 'js', 'css', 'изображения' и 'manifest'
        
        expires 1s; # Кэширование на 1 год (для файлов с хешами в имени)
        access_log off;
        
        # Установка заголовков для управления кэшем
        add_header Cache-Control "public, must-revalidate, proxy-revalidate";
        try_files $uri =404;
    }
    
    # 4. Обработка файла Service Worker
    # Service Worker должен быть подан без кэширования, чтобы он мог обновляться
    # (хотя сам SW часто управляет своим кэшем).
    location ~ ^/(service-worker\.js|worker\.js)$ {
        expires -1; # Запрет кэширования
        add_header Cache-Control "no-cache";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        try_files $uri =404;
    }

    # 5. Сжатие Gzip (Обязательно для скорости)
    gzip on;
    gzip_vary on;
    gzip_disable "msie6";
    gzip_comp_level 6;
    gzip_min_length 256;
    gzip_proxied any;
    gzip_types application/javascript text/css text/plain application/xml application/json;
}